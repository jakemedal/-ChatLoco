
                                                                                      /*.;lxoollccclllodOd.                                            
                                                                                    .;clollccccccccccclldlc:.                                         
                                                                                  .,lolcccccccccccccccccccldo;.                                       
                                                                                .:lllccccccccccccccccccccccclod'                                      
                                                                               .ldlcccccccccccccccccccccccccccll;.                                    
                                                                              .ldlccccccccccccccccccccccccccccclxo.                                   
                                                                            ..lxlccccccccccccccccccccccccccccccclx:                                   
                                                                        .;::lollcccccccccccccccccccccccccccccccccoc.                                  
                                                                      .:oollccccccccccccccccccccccccccccccccccccclx:                                  
                                                                     .oxlccccccccccccccccccccccccccccccccccccccccld;                                  
                                                                     ;xlccccccccccccccccccccccccccccccccccccccccclx;                                  
                                                                     ,occcccccccccccccccccccccccccccccccccccccccclk:                                  
                                                                     'lcccccccccccccccccccccccccccccccccccccccccclxo.                                 
                                                                     ,occccccccccccccccccccccccccccccccccccccccccclxx,                                
                                                                     'olcccccccccccccccccccccccccccccccccccccccccccldx,                               
                                                                      :xlcccccccccccccccccccccccccccccccccccccccccccldl.                              
                                                                      .oxlccccccccccccccccccccccccccccccccccccccccccclOc                              
                                                                       .:oollccccccccccccccccccccccccccccccccccccccccld;                              
                                                                         ,xkxoccccccccccccccccccccccccccccccccccccccccd;                              
                                                                          .':xxolcccccccccccccccccccccccccccccccccccclx:                              
                      .,,,,,.                                                .';dxdolccccccccccccccccccccccccccccccccoxl'''.                          
      .,lxxxxxxxxxl,. lNK0KNl                                                   .''cdlccccccccccccccccccccccccccccccclooodxoc;'.                      
   .lx0X0OkxxxxxkkOXK,lKocdKl                                 .,,lkk,              ,xdlcccccccccccccccccccccccccccccccccccclloxd:.                    
 .l0Kkdolodxkkkkxdd0WllKocoKl                                 lWKO0Nl               .lxlcccccccccccccccccccccccccccccccccccccccldd:.                  
,KXkoldkKOdxl,lxxddxl.lKocdKl .,.              .,. .,,.       lKdcdKl                .clldllccccccccccccccccccccccccccccccccccccllddl:.               
KKdclkXx,.            lKocoKKxOXklodxl,.   .,lxOXklkXN0xl. ,xdO0oco0Odddx,              .;cokxdooodxdoccccccccccccccccccccccccccccclldl,'.            
XdclkNx.              lKoco00kdoolodkKWk.  lW0xdddddooxOXK,lXkdolclodddkNl                 .,,'...'':xdlccccccccccccccccccccccccccccccclxl.           
OlcdXK,               lKocloxO0KK0xlco0Wl  lWKOKXOoOKkoldKxl0XKkocok0KKXWl                           .:odlccccccccccccccccccccccccccccccloo'          
xccxNl                lKoclkXKl,,xNOlcdKK, .lkllkl,lKNkllkNl.,xKdcoKx,,,,.  'c,',c'                    .:clollllccccllccccccccccccccccccccoo'         
xccxXl                lKocoKK,   .xKdco0x.  .lxOK0OOkkdlcxXl  lKdcdKl       'x0K0x'                       .';cc::;;:clllccccccccccccccccccco;         
OlcdKK,               lKocoKl     lXdco0l ,xO0xoodxkkkxlcdXl  lKdcoKl       'xNWXx.                                   ,codlllcccccccccccccclcc;.      
XdclxXK,              lKocoKl     lXdco0l.xNkllxKNKxx00ocdXl  lKdcoKl       'xNMXx.                .,'..',.             ,okkooxxxxxxxdlcccccclolc:.   
0KdlldK0l,,.   .,,,,. lKocoKl     lXdco0clW0ocdKKl..l0OlcdXl  lKdcoKK,      'xNMXx.            .';cd00OO00dc;'.      .;cd0KOkO00OOo,,ldllodxxxxddxx'  
,KXkolldO0XOdddOXKKNK,lKocoKl     lXdco0c,KKdcoOX0x0XOoccdXl  lXxclkXOdxx,  'xNWXx.          .;dO0KNNNXNNNNKOOl.   .,dOKXNNNNNNNKx,.:xOOKXNNXNNNX0Oo,.
 .lKXOxdolloodooood0WllKdldKl     lXdlo0l ,0KxllodxddxkdldXx. ,0KdlloddONl  'xNWXx.         .ok0NWN00xlx00KWWXOd' .oOXWWX0000000OOolk0NWN00xlx0OXWWXOd
   .,lxOXK0OOOO00KX0x,lWXKXWl     lWXKKNl  ,x0X0OO0KOx0XKXWK,  .lOK0OO0XK,  'xNWXx.         :k0WWXOo:. .'lk0WMNOdoo0NMNOo;',,,'..'lk0WWXkd:. .'ck0WWXk
       .,,,,,,,,,,,.  .,,,,,.     .,,,,,.    .,,,,,,. .,,,,.     .,,,,,,.   'xNWXx.         ,kXMW0O:     .lkXWWKkkkXWW0O:        'dkNMN0d'     .ckXWWK
                                                                            'xNWXx.         ,kNMNO0c      :OKWWKxdONMNO0c        ,dONMNO,       ;kKWWK
                                                                            'xNMXx.         ,kXMNOO:      ;kKWWKkxONMW0O:        'oONMNOd'     .lkXMWK
                                                                            'xNWXx;'''''''''lkKWWXkd:.  .;o0NMNOdxkKWWNOd;'. .,'.'lkKWWXk:.   .lk0NWXk
                                                                            'xNMN0O000000000kkO0NWN0Oxccd0KNWXOd'.oO0NWNK00xcx00OOooOKNWX0dclldOKWWXOd
                                                                            'xXWWNNNNNNNNNNKxOkdOKXNNNNNNNNK0Ol.  .;oOKXNWNNNNNNKk,.;oOKXNNNXNNNNK0d,.
                                                                            ,dkkkkkkkkkkkkkxxo'.dOkOKKKKKOkko:'     .dkxO0KKKK0Okk;  .dOkOKKKK0Okko.*/                                                       

using ChatLoco.Controllers;
using Microsoft.VisualStudio.TestTools.UnitTesting;
using System.Collections.Generic;
using System.Web.Mvc;
using ChatLoco.Models.User_Model;
using ChatLoco.DAL;


namespace ChatLocoTest
{
    [TestClass]
    public class UserControllerTest
    {

        /* --This section is run everytime before any of the tests-- */
        /* --ensures the database doesn't have left over data from previous tests so that each time we run the tests the data is consistent--*/
/*###########################################################################################################################################*/

        //Need a reference to the db context
        private ChatLocoContext _db = new ChatLocoContext();
        //Holds all the test user data that will be used throughout the tests
        List<UserTestModel> testUsers = new List<UserTestModel>();


        //Always initialize the list of uses that will be used in the below tests
        //In order to add more users to the tests, just add them here
        private void initializeUsers()
        {
            testUsers = new List<UserTestModel>();
            testUsers.Add(new UserTestModel() { Username = "test_user_01", Password = "test01", Email = "test_user_01@test.com" });
        }

        //Construct a list of all test users to be removed from the db
        private List<RemoveUserRequestModel> initializeRemovableUsers()
        {
            List<RemoveUserRequestModel> users = new List<RemoveUserRequestModel>();
            foreach (UserTestModel us in testUsers)
            {
                users.Add(new RemoveUserRequestModel() { Username = us.Username });
            }
            return users;
        }

        //constructor - always delete the users that were created if not already gone
        public UserControllerTest()
        {
            //Initialize the users
            initializeUsers();

            //grab the list of users to make sure are deleted.
            List<RemoveUserRequestModel> removals = initializeRemovableUsers();

            UserController userControllerTest = new UserController();

            foreach (RemoveUserRequestModel res in removals)
            {
                var result = userControllerTest.RemoveUser(res) as JsonResult;
                if (((RemoveUserResponseModel)result.Data).Errors.Count == 1)
                {
                    if (((RemoveUserResponseModel)result.Data).Errors[0].ErrorMessage == "user.no.exist")
                    {
                        //not a problem move on
                    }
                    else
                    {
                        //was an acutal problem with removing the user!! Fail and leave!!!
                        Assert.AreEqual("1","2");
                    }
                }
            }
        }


        /* --This section includes default View functions-- */
/*###########################################################################################################################################*/

        /*
            Test Description:
                Call the Index method
            Expected Result:
                The Index view 
        */
        [TestMethod]
        public void ReturnIndexView()
        {
            UserController userControllerTest = new UserController();
            var result = userControllerTest.Index() as ViewResult;
            Assert.AreEqual("", result.ViewName);
        }

        /*
            Test Description:
                Call the Settings method
            Expected Result:
                The Settings view 
        */
        [TestMethod]
        public void ReturnSettingsView()
        {
            UserController userControllerTest = new UserController();
            var result = userControllerTest.Settings() as ViewResult;
            Assert.AreEqual("", result.ViewName);
        }

        /*
            Test Description:
                Call the Create method
            Expected Result:
                The Create view 
        */
        [TestMethod]
        public void ReturnCreateView()
        {
            UserController userControllerTest = new UserController();
            var result = userControllerTest.Index() as ViewResult;
            Assert.AreEqual("", result.ViewName);
        }

        /*
            Test Description:
                Call the Login method
            Expected Result:
                The Login view with no actual html
        */
        [TestMethod]
        public void ReturnLoginView()
        {
            UserController userControllerTest = new UserController();
            var result = userControllerTest.Index() as ViewResult;
            Assert.AreEqual("", result.ViewName);
        }

        /* --This section includes Partial View functions-- */
/*###########################################################################################################################################*/
        /*
            Test Description:
                Call the GetLoginForm method
            Expected Result:
                The partial view _Login.cshtml
        */
        [TestMethod]
        public void ReturnGetLoginForm()
        {
            UserController userControllerTest = new UserController();
            var result = userControllerTest.GetLoginForm() as PartialViewResult;
            Assert.AreEqual("~/Views/User/_Login.cshtml", result.ViewName);
        }

        /*
            Test Description:
                Call the GetSettingsForm method
            Expected Result:
                The partial view _Settings.cshtml
        */
        [TestMethod]
        public void ReturnGetSettingsForm()
        {
            UserController userControllerTest = new UserController();
            var result = userControllerTest.GetSettingsForm() as PartialViewResult;
            Assert.AreEqual("~/Views/Settings/_Settings.cshtml", result.ViewName);
        }

        /*
            Test Description:
                Call the GetManageUsersForm method
            Expected Result:
                The partial view Index.cshtml
        */
        [TestMethod]
        public void ReturnGetManageUsersForm()
        {
            UserController userControllerTest = new UserController();
            var result = userControllerTest.GetManageUsersForm() as PartialViewResult;
            Assert.AreEqual("~/Views/ManageUsers/Index.cshtml", result.ViewName);
        }


        /* --This section is the fun stuff. Begin testing database functions-- */
/*###########################################################################################################################################*/

        /*
            Test Description:
                Call the UserInfo method
            Expected Result:
                The partial view Index.cshtml
        */
        [TestMethod]
        public void ReturnUserInfo()
        {
            /*UserController userControllerTest = new UserController();
            //Pass in test data model
            UserInfoRequestModel model = new UserInfoRequestModel();
            model.Username = "mitinz";
            model.Id = 40;
            //retrieve the partial view
            var result = userControllerTest.GetUserInfo(model) as PartialViewResult;

            //mock data to check against
            UserInfoResponseModel comparator = new UserInfoResponseModel();
            comparator.Username = "mitinz";
            comparator.DefaultHandle = "mitinz";
            comparator.Email = "mitinz@mitinz.com";

            Assert.AreEqual("~/Views/User/_UserInfo.cshtml", result.ViewName);
            Assert.IsInstanceOfType(result.ViewData.Model, typeof(UserInfoResponseModel));
            Assert.AreEqual(comparator.Username, ((UserInfoResponseModel)result.ViewData.Model).Username);
            Assert.AreEqual(comparator.DefaultHandle, ((UserInfoResponseModel)result.ViewData.Model).DefaultHandle);
            Assert.AreEqual(comparator.Email, ((UserInfoResponseModel)result.ViewData.Model).Email);*/
        }

        /*
            Test Description:
                Call the CreateUser method
            Expected Result:
                A User will be created in the database and return a JsonResult with 0 errors 
        */
        [TestMethod]
        public void ReturnCreateUser()
        {
            UserController userControllerTest = new UserController();
            //Pass in test data model
            CreateUserRequestModel model = new CreateUserRequestModel();
            model.Username = testUsers[0].Username;
            model.Password = testUsers[0].Password;
            model.Email = testUsers[0].Email;
            var result = userControllerTest.CreateUser(model) as JsonResult;
            Assert.AreEqual(0, ((CreateUserResponseModel)result.Data).Errors.Count);
        }
    }
}
